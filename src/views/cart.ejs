<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Đặt cơm CG</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <%- include('header') -%>
    <div class="container">
      <div class="order-container">
        <form action="/cart" method="post">
          <h1 style="margin-bottom: 10px">Thông tin đơn hàng</h1>
          <hr />
          <% if(alert) { %>
          <p style="color: red"><%= alert %></p>
          <% } %> <% if(data.length > 0) { %> <% data.forEach((item) => { %> <%
          if(item.foods[0].food.status) { %>
          <input
            type="text"
            name="foodName"
            style="display: none"
            value="<%= item.foods[0].food.name %>"
          />
          <input
            type="text"
            name="foodType"
            style="display: none"
            value="<%= item.foods[0].food.type %>"
          />
          <div id="<%=item._id%>" >
            <div class="order-card">
              <img
                src="<%= item.foods[0].food.imageUrl %>"
                alt="<%= item.foods[0].food.name %>"
              />
              <div>
                <h4><%= item.foods[0].food.name %></h4>
                <p>Order vào lúc: <%= item.dateOrder.toDateString() %></p>
                <h6><%= item.foods[0].food.type %></h6>
                <button class="btn btn-danger delete-cart"
                        data-id="<%= item.id %>"
                        user-id="<%= locals.userLogin.id %>"
                        style="width: 50%"
                        type="button">
                  Xoá món ăn
                </button>
              </div>
            </div>
            <hr />
          </div>
          <% } %> <% }) %> <% } else { %>
          <h6 style="margin-bottom: 20px">
            Rỏ hàng hiện tại đang trống, vào <a href="/">đây</a> để mua hàng
            ngay!
          </h6>
          <% } %>
          <button type="submit" class="btn btn-primary btn-admin">
            Thanh toán
          </button>
        </form>
      </div>
    </div>
  </body>
  <script>
      $('.delete-cart').click(function() {
        let wantDelete = confirm("Want to delete?");
        if (wantDelete){
          const idFood = $(this).attr('data-id');
          const userId = $(this).attr('user-id');
          if(!userId) {
            top.location.href="login";
            return;
          }
          const origin = location.origin;
          console.log(`${origin}/order/delete/${idFood}`);
          $.ajax({
            url: `${origin}/order/delete/${idFood}`,
            data: {
              id: idFood,
              userId: userId
            },
            method: "POST",
            success: (response) => {
              if (response._id.length > 0) {
                $(`#${response._id}`).remove();
              } else {
                top.location.href="/";
                return;
              }
            }
          })
        }

      })
  </script>
</html>

