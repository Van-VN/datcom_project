<!DOCTYPE html>
<html>
<head>
    <!-- jQuery -->
    <script src="js/jquery-2.0.0.min.js" type="text/javascript"></script>

    <!-- Bootstrap4 files-->
    <script src="js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"/>

    <!-- Font awesome 5 -->
    <link href="fonts/fontawesome/css/all.min.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- custom style -->
    <link href="css/pay.css" rel="stylesheet" type="text/css"/>
    <link href="css/ui.css" rel="stylesheet" type="text/css"/>
    <link href="css/responsive.css" rel="stylesheet"/>

    <!-- custom javascript -->
    <script src="js/script.js" type="text/javascript"></script>


</head>
<body>
<%- include('../header.ejs'); -%>
<section class="section-content padding-y bg">
    <div class="container">
        <!-- ============================ COMPONENT 1 ================================= -->

        <div class="row">
            <aside class="col-lg-9">
                <div class="card">
                    <table id="list-san-pham" class="table table-borderless table-shopping-cart">
                        <thead class="text-muted">
                        <tr class="small text-uppercase">
                            <th scope="col">Sản Phẩm</th>
                            <th scope="col" width="120">Số lượng</th>
                            <th scope="col" width="120">Giá</th>
                            <th scope="col" class="text-right" width="200"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <%- include('itemCart.ejs'); -%>

                        </tbody>
                    </table>

                    <div class="card-body border-top">
                        <p class="icontext">
                            <i class="icon text-success fa fa-truck"></i>
                            Miễn phí vận chuyển trong 1-2 ngày
                        </p>
                    </div>
                    <!-- card-body.// -->
                </div>
                <!-- card.// -->
            </aside>
            <!-- col.// -->
            <aside class="col-lg-3">
                <div class="card mb-3">
                    <div class="card-body">
                        <form class="myForm">
                            <div class="form-group">
                                <label>Nhập mã khuyến mại</label>
                                <div class="input-group">
                                    <input
                                            type="text"
                                            class="form-control"
                                            name="code"
                                            placeholder="Mã"
                                    />
                                    <span class="input-group-append">
                                        <button class="btn btn-primary">Áp dụng</button>
                                    </span>
                                    <div class="result mt-3"></div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- card-body.// -->
                </div>
                <!-- card.// -->

                <div class="card">
                    <div class="card-body">
                        <dl class="dlist-align">
                            <dt>Tổng số tiền:</dt>
                            <dd id="total-amount" class="text-right">0$</dd><span>$</span>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Discount:</dt>
                            <dd id="discoundt" class="text-right text-danger">0$</dd><span></span>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Total:</dt>
                            <dd id="total-discount" class="text-right text-dark b">
                                <strong>0$</strong>
                            </dd><span>$</span>
                        </dl>
                        <hr />
                        <button type="button" class="btn btn-primary btn-block" data-toggle="modal" data-target=".bd-example-modal-lg">Đặt Hàng </button>
                        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <form action="/action_page.php" class="form-pay">

                                        <div class="row1">
                                            <div class="col-50">
                                                <h3>Thông tin người nhận</h3>
                                                <label for="fname"><i class="fa fa-user"></i> Tên người nhận </label>
                                                <input type="text" id="fname" name="firstname" placeholder="John M. Doe">
                                                <label for="email"><i class="fa fa-envelope"></i> Email</label>
                                                <input type="text" id="email" name="email" placeholder="john@example.com">
                                                <label for="adr"><i class="fa fa-address-card-o"></i> Địa chỉ</label>
                                                <input type="text" id="adr" name="address" placeholder="123 ABC ">
                                                <label for="city"><i class="fa fa-institution"></i> Thành Phố</label>
                                                <input type="text" id="city" name="city" placeholder="Hồ Chí Minh">


                                            </div>

                                            <div class="col-50">
                                                <h3>Payment</h3>
                                                <label for="fname">Accepted Cards</label>
                                                <div class="icon-container">
                                                    <i class="fa fa-cc-visa" style="color:navy;"></i>
                                                    <i class="fa fa-cc-amex" style="color:blue;"></i>
                                                    <i class="fa fa-cc-mastercard" style="color:red;"></i>
                                                    <i class="fa fa-cc-discover" style="color:orange;"></i>
                                                </div>
                                                <label for="cname">Tên chủ thẻ</label>
                                                <input type="text" id="cname" name="cardname" placeholder="John More Doe">
                                                <label for="ccnum">Mã số thẻ</label>
                                                <input type="text" id="ccnum" name="cardnumber" placeholder="1111-2222-3333-4444">
                                                <div class="row">
                                                    <div class="col-50">
                                                        <label for="expyear">Ngày hết hạn</label>
                                                        <input type="text" id="expyear" name="expyear" placeholder="2018">
                                                    </div>
                                                    <div class="col-50">
                                                        <label for="cvv">CVV</label>
                                                        <input type="text" id="cvv" name="cvv" placeholder="352">
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <label>
                                            <input type="checkbox" checked="checked" name="sameadr"> Giao hàng
                                        </label>
                                        <input type="submit" value="Thanh toán" class="btn bt11 btn-primary">
                                    </form>




                                </div>
                            </div>
                        </div>



                        <a href="/" class="btn btn-light btn-block"
                        >Tiếp tục mua hàng</a
                        >
                    </div>
                    <!-- card-body.// -->
                </div>
                <!-- card.// -->
            </aside>
            <!-- col.// -->
        </div>
        <!-- row.// -->
    </div>
    <!-- container .//  -->
</section>

<%- include('../footer'); -%>
<script src="js/giohang.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Import jQuery từ CDN -->
<script>
    // Lắng nghe sự kiện submit form
    $('.myForm').submit(function(event) {
        event.preventDefault(); // Ngăn chặn việc tải lại trang
        const formData = $(this).serialize(); // Chuyển đổi dữ liệu form thành chuỗi query string
        const url = '/check-discount-code'; // Đường dẫn API xử lý dữ liệu (thay đổi theo yêu cầu)

        // Gửi yêu cầu POST đến máy chủ Node.js
        $.post(url, formData)
            .done(function(response) {
                let total = getSum($('.price-value'));
                if (response == 0) {
                    $('.result').text('Mã giảm giá không đúng')
                    $('#total-amount').text(total);
                    $('#discoundt').text('0$');
                    $('#total-discount').text(total);

                } else {
                    $('.result').text('Bạn được giảm ' + response + "%")
                    $('#total-amount').text(total);
                    $('#discoundt').text((total/response)  + '$');
                    $('#total-discount').text(total - total/response);
                }
            })
            .fail(function(error) {
                console.error(error.message);
            });
    });

    $('.btn-remove').click(function(){
        var productId = $(this).data('product-id');
        $.ajax({
            url: '/delete-product-cart', // Đường dẫn đến API hoặc endpoint của máy chủ để lấy danh sách sản phẩm trong giỏ hàng
            type: 'POST',
            data: { productId: productId },
            success: function (response) {
                $('.number-cart').text(response)
                console.log(response); // In danh sách sản phẩm trong giỏ hàng ra console
            },
            error: function (xhr, status, error) {
                console.log(error); // In thông báo lỗi ra console
            }
        });

    })


</script>

</body>
<script src="js/giohang.js"></script>
</html>